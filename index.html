<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Target Number Game</title>

<style>
:root{
  --bg1:#1a6ed8;
  --bg2:#3fa9f5;
  --panel:#0f2f57;

  --num:#1f8fff;
  --numShadow:#0c4fa3;

  --opAdd:#2ecc71;
  --opSub:#f39c12;
  --opMul:#9b59b6;
  --opDiv:#e74c3c;

  --btn:#34495e;
  --btnShadow:#1f2d3a;

  --white:#fff;
}

html,body{
  height:100%;
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:linear-gradient(160deg,var(--bg1),var(--bg2));
  color:var(--white);
  display:flex;
  align-items:center;
  justify-content:center;
}

.container{
  width:960px;
  max-width:96vw;
  padding:18px;
  background:var(--panel);
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.45);
  position:relative;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.title{font-size:22px;font-weight:800;}

.settings{
  display:flex;
  gap:8px;
  align-items:center;
  font-size:14px;
}

select{
  padding:6px 8px;
  border-radius:8px;
  border:none;
  background:#224a7c;
  color:white;
}
select option{
  background:#224a7c;
  color:white;
}

.row{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:14px;
  margin:16px 0;
  flex-wrap:wrap;
}

.target{
  background:#08213f;
  padding:10px 18px;
  border-radius:10px;
  font-size:30px;
  font-weight:900;
  color:#ff7676;
  min-width:90px;
  text-align:center;
}

.num,.op,.btn{
  border:none;
  color:white;
  font-weight:800;
  cursor:pointer;
  border-radius:16px;
  transition:transform .05s, box-shadow .05s, filter .05s;
}

.num{
  min-width:160px;
  padding:34px;
  font-size:44px;
  background:var(--num);
  box-shadow:0 8px var(--numShadow);
}
.op{
  min-width:110px;
  padding:26px;
  font-size:36px;
  box-shadow:0 7px rgba(0,0,0,.35);
}

.op.add{background:var(--opAdd);}
.op.sub{background:var(--opSub);}
.op.mul{background:var(--opMul);}
.op.div{background:var(--opDiv);}

.btn{
  background:var(--btn);
  padding:10px 16px;
  box-shadow:0 6px var(--btnShadow);
}

.num:active,.op:active,.btn:active{
  transform:translateY(4px);
  box-shadow:0 3px rgba(0,0,0,.4);
}

.selected{
  filter:brightness(1.35);
}

.disabled{
  opacity:.4;
  pointer-events:none;
}

.solutionBox{
  margin-top:10px;
  background:rgba(0,0,0,.35);
  padding:10px;
  border-radius:8px;
  font-size:14px;
}

.footer{
  text-align:center;
  font-size:13px;
  opacity:.9;
}

.fireworks{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:64px;
  pointer-events:none;
  animation:pop 2s ease-out forwards;
}
@keyframes pop{
  0%{opacity:0;transform:scale(.6);}
  20%{opacity:1;transform:scale(1);}
  100%{opacity:0;}
}
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <div class="title">Target Number Game</div>
    <div class="settings">
      Mode:
      <select id="modeSelect">
        <option value="4">4 numbers</option>
        <option value="3">3 numbers</option>
      </select>
      Max:
      <select id="maxSelect">
        <option value="99">99</option>
        <option value="50">50</option>
      </select>
    </div>
  </div>

  <div class="row">
    Target <div class="target" id="targetValue">--</div>
    Score <span id="score">0</span>
    Problems <span id="problems">0</span>
  </div>

  <div class="row">
    <button class="op add" data-op="+">+</button>
    <button class="op sub" data-op="-">âˆ’</button>
    <button class="op mul" data-op="*">Ã—</button>
    <button class="op div" data-op="/">Ã·</button>
  </div>

  <div class="row" id="numbersRow"></div>

  <div class="row">
    <button id="hintBtn" class="btn">Hint (1st Move)</button>
    <button id="solutionBtn" class="btn">Show Solution</button>
    <button id="resetBtn" class="btn">Reset</button>
    <button id="newBtn" class="btn">New</button>
  </div>

  <div id="solutionBox" class="solutionBox" style="display:none"></div>

  <div class="footer">
    Use each number once per step. Intermediate results must be integers.
  </div>
</div>

<script>
const randInt=m=>Math.floor(Math.random()*(m+1));
const weightedNumber=()=>Math.random()<0.08?0:randInt(10);

const state={
  mode:4,max:99,
  numbers:[],original:[],solution:[],
  target:0,selection:{first:null,op:null},
  score:0,problems:0,
  moveCount:0,usedHint:false,solutionShown:false
};

const numbersRow=document.getElementById('numbersRow');
const targetEl=document.getElementById('targetValue');
const scoreEl=document.getElementById('score');
const problemsEl=document.getElementById('problems');
const hintBtn=document.getElementById('hintBtn');
const resetBtn=document.getElementById('resetBtn');
const solutionBtn=document.getElementById('solutionBtn');
const solutionBox=document.getElementById('solutionBox');

function solve(nums,target){
  if(nums.length===1) return nums[0]===target?[]:null;
  for(let i=0;i<nums.length;i++)for(let j=0;j<nums.length;j++){
    if(i===j)continue;
    const a=nums[i],b=nums[j];
    const rest=nums.filter((_,k)=>k!==i&&k!==j);
    const ops=[
      {v:a+b,op:'+'},{v:a*b,op:'*'},
      {v:a-b,op:'-'},{v:b-a,op:'-'}
    ];
    if(b!==0&&a%b===0)ops.push({v:a/b,op:'/'});
    if(a!==0&&b%a===0)ops.push({v:b/a,op:'/'});
    for(const o of ops){
      if(!Number.isInteger(o.v))continue;
      const r=solve([o.v,...rest],target);
      if(r)return[{ai:i,bi:j,op:o.op},...r];
    }
  }
  return null;
}

function newProblem(){
  solutionBox.style.display='none';
  hintBtn.classList.remove('disabled');
  resetBtn.classList.remove('disabled');
  solutionBtn.classList.remove('disabled');

  state.moveCount=0;
  state.usedHint=false;
  state.solutionShown=false;

  while(true){
    const nums=Array.from({length:state.mode},weightedNumber);
    for(let t=0;t<60;t++){
      const target=randInt(state.max);
      if(nums.includes(target))continue;
      const sol=solve(nums.slice(),target);
      if(sol){
        state.numbers=nums.slice();
        state.original=nums.slice();
        state.target=target;
        state.solution=sol;
        targetEl.textContent=target;
        render();
        resetSelection();
        return;
      }
    }
  }
}

function render(){
  numbersRow.innerHTML='';
  state.numbers.forEach((n,i)=>{
    const b=document.createElement('button');
    b.className='num';
    b.textContent=n;
    b.onclick=()=>numberClick(i,b);
    numbersRow.appendChild(b);
  });
}

function clearHighlights(){
  document.querySelectorAll('.selected').forEach(b=>b.classList.remove('selected'));
}
function resetSelection(){
  state.selection={first:null,op:null};
  clearHighlights();
}

document.querySelectorAll('.op').forEach(b=>{
  b.onclick=()=>{
    if(state.selection.first===null||state.solutionShown)return;
    clearHighlights();
    b.classList.add('selected');
    state.selection.op=b.dataset.op;
    numbersRow.children[state.selection.first]?.classList.add('selected');
  };
});

function numberClick(i,btn){
  if(state.solutionShown)return;
  const s=state.selection;
  if(s.first===i&&s.op===null){resetSelection();return;}
  if(s.first===null){s.first=i;btn.classList.add('selected');return;}
  if(s.op===null||i===s.first)return;

  btn.classList.add('selected');
  const a=state.numbers[s.first],b=state.numbers[i];
  if(s.op==='/'&&(b===0||a%b!==0))return;

  const res=eval(`${a}${s.op}${b}`);
  state.moveCount++;
  hintBtn.classList.add('disabled');

  setTimeout(()=>{
    state.numbers=state.numbers.filter((_,k)=>k!==s.first&&k!==i);
    state.numbers.unshift(res);
    render();
    resetSelection();

    if(state.numbers.length===1){
      state.problems++;
      problemsEl.textContent=state.problems;
      if(state.numbers[0]===state.target&&!state.solutionShown){
        const pts=state.usedHint
          ?(state.mode===3?50:70):100;
        state.score+=pts;
        scoreEl.textContent=state.score;
        fireworks();
        setTimeout(newProblem,2000);
      }
    }
  },450);
}

function fireworks(){
  const f=document.createElement('div');
  f.className='fireworks';
  f.textContent='ðŸŽ†ðŸŽ‡âœ¨';
  document.querySelector('.container').appendChild(f);
  setTimeout(()=>f.remove(),2000);
}

hintBtn.onclick=()=>{
  if(state.moveCount>0||state.solutionShown)return;
  state.usedHint=true;
  const step=state.solution[0];
  let d=0;
  [()=>highlightNum(step.ai),
   ()=>highlightOp(step.op),
   ()=>highlightNum(step.bi),
   clearHighlights].forEach(fn=>setTimeout(fn,d+=500));
};

function highlightNum(i){
  clearHighlights();
  numbersRow.children[i]?.classList.add('selected');
}
function highlightOp(op){
  clearHighlights();
  document.querySelector(`.op[data-op="${op}"]`)?.classList.add('selected');
}

solutionBtn.onclick=()=>{
  state.solutionShown=true;
  hintBtn.classList.add('disabled');
  resetBtn.classList.add('disabled');
  solutionBtn.classList.add('disabled');

  let nums=state.original.slice();
  const steps=[];
  state.solution.forEach(s=>{
    const a=nums[s.ai],b=nums[s.bi];
    const sym=s.op==='*'?'Ã—':s.op==='/'?'Ã·':s.op;
    const r=eval(`${a}${s.op}${b}`);
    steps.push(`${a} ${sym} ${b} = ${r}`);
    nums=nums.filter((_,i)=>i!==s.ai&&i!==s.bi);
    nums.unshift(r);
  });
  solutionBox.innerHTML=`<b>One valid solution:</b> ${steps.join('; ')}`;
  solutionBox.style.display='block';
};

resetBtn.onclick=()=>{
  if(state.solutionShown)return;
  state.numbers=state.original.slice();
  state.moveCount=0;
  state.usedHint=false;
  render();
  resetSelection();
  hintBtn.classList.remove('disabled');
};

document.getElementById('newBtn').onclick=newProblem;
document.getElementById('modeSelect').onchange=e=>{state.mode=+e.target.value;newProblem();};
document.getElementById('maxSelect').onchange=e=>{state.max=+e.target.value;newProblem();};

newProblem();
</script>
</body>
</html>
