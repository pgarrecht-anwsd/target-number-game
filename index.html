<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Target Number Game</title>

<style>
:root{
  --blue:#1e5799;
  --op1:#2d7f5e;
  --op2:#c75f00;
  --op3:#6b2d7f;
  --op4:#d03b3b;
  --white:#fff;
}

html,body{
  height:100%;
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:linear-gradient(180deg,#0b2a4a 0%, #123a63 100%);
  color:var(--white);
  display:flex;
  align-items:center;
  justify-content:center;
}

.container{
  width:960px;
  max-width:96vw;
  padding:18px;
  margin-top:48px;
  background:rgba(255,255,255,0.03);
  border-radius:12px;
  box-shadow:0 6px 20px rgba(0,0,0,0.4);
}

.header{
  display:flex;
  justify-content:space-between;
  margin-bottom:12px;
}

.title{font-size:20px;font-weight:700;}

.settings{display:flex;gap:8px;align-items:center;}
.rules{font-size:13px;opacity:.9;}

select{
  padding:6px;
  border-radius:6px;
  border:none;
  background:rgba(255,255,255,0.05);
  color:var(--white);
}

.target{
  background:var(--blue);
  padding:10px 18px;
  border-radius:10px;
  font-size:28px;
  font-weight:800;
  color:#ff6666;
  min-width:80px;
  text-align:center;
}

.row{
  display:flex;
  justify-content:center;
  gap:14px;
  margin:18px 0;
}

.op{
  min-width:110px;
  padding:28px;
  font-size:38px;
  border-radius:16px;
  border:none;
  font-weight:800;
  color:white;
  cursor:pointer;
}

.op.add{background:var(--op1);}
.op.sub{background:var(--op2);}
.op.mul{background:var(--op3);}
.op.div{background:var(--op4);}

.num{
  min-width:170px;
  padding:36px;
  font-size:44px;
  border-radius:18px;
  background:var(--blue);
  border:none;
  font-weight:800;
  color:white;
  cursor:pointer;
}

.selected{filter:brightness(150%);}

.btn{
  background:rgba(255,255,255,0.08);
  border:none;
  color:white;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}

.footer{
  display:flex;
  justify-content:space-between;
  margin-top:12px;
  font-size:13px;
  opacity:.9;
}

.canvas-wrap{position:relative;height:120px;}
#fireworksCanvas{position:absolute;inset:0;display:none;}
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <div class="title">Target Number Game</div>
    <div class="settings">
      <label class="rules">Mode:</label>
      <select id="modeSelect">
        <option value="4">4 numbers</option>
        <option value="3">3 numbers</option>
      </select>
      <label class="rules">Max:</label>
      <select id="maxSelect">
        <option value="99">99</option>
        <option value="50">50</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div>Target</div>
    <div class="target" id="targetValue">--</div>
    <div>Hints: <span id="hintsUsed">0</span></div>
    <div>Score: <span id="score">0</span></div>
  </div>

  <div class="row ops">
    <button class="op add" data-op="+">+</button>
    <button class="op sub" data-op="-">−</button>
    <button class="op mul" data-op="*">×</button>
    <button class="op div" data-op="/">÷</button>
  </div>

  <div class="row numbers" id="numbersRow"></div>

  <div class="row">
    <button id="hintBtn" class="btn">Hint</button>
    <button id="resetBtn" class="btn">Reset</button>
    <button id="newBtn" class="btn">New</button>
  </div>

  <div class="canvas-wrap">
    <canvas id="fireworksCanvas"></canvas>
  </div>

  <div class="footer">
    Click a number, then an operation, then another number. Intermediate results must be integers.
  </div>
</div>

<script>
// --------------------
// Utilities
// --------------------
const randInt = m => Math.floor(Math.random()*(m+1));

// --------------------
// Game state
// --------------------
const state={
  mode:4,
  max:99,
  numbers:[],
  original:[],
  target:0,
  solution:[],
  selection:{first:null,op:null},
  score:0,
  hints:0
};

// --------------------
// DOM refs
// --------------------
const numbersRow=document.getElementById('numbersRow');
const targetEl=document.getElementById('targetValue');
const scoreEl=document.getElementById('score');
const hintsEl=document.getElementById('hintsUsed');

// --------------------
// Solver (single solution)
// --------------------
function solve(nums,target){
  if(nums.length===1) return nums[0]===target?[]:null;
  for(let i=0;i<nums.length;i++){
    for(let j=0;j<nums.length;j++){
      if(i===j) continue;
      const a=nums[i],b=nums[j];
      const rest=nums.filter((_,k)=>k!==i&&k!==j);
      const ops=[
        {v:a+b,op:'+'},
        {v:a-b,op:'-'},
        {v:a*b,op:'*'}
      ];
      if(b!==0&&a%b===0) ops.push({v:a/b,op:'/'});
      for(const o of ops){
        if(!Number.isInteger(o.v)) continue;
        const r=solve([o.v,...rest],target);
        if(r) return [{a,b,op:o.op},...r];
      }
    }
  }
  return null;
}

// --------------------
// New problem
// --------------------
function newProblem(){
  while(true){
    const nums=Array.from({length:state.mode},()=>randInt(10));
    for(let t=0;t<=state.max;t++){
      const sol=solve(nums.slice(),t);
      if(sol){
        state.numbers=nums.slice();
        state.original=nums.slice();
        state.target=t;
        state.solution=sol;
        state.hints=0;
        break;
      }
    }
    if(state.solution.length) break;
  }
  targetEl.textContent=state.target;
  hintsEl.textContent=0;
  render();
  resetSelection();
}

// --------------------
// Render
// --------------------
function render(){
  numbersRow.innerHTML='';
  state.numbers.forEach((n,i)=>{
    const b=document.createElement('button');
    b.className='num';
    b.textContent=n;
    b.onclick=()=>numberClick(i);
    numbersRow.appendChild(b);
  });
}

// --------------------
// Selection helpers
// --------------------
function clearHighlights(){
  document.querySelectorAll('.selected').forEach(b=>b.classList.remove('selected'));
}

function resetSelection(){
  state.selection={first:null,op:null};
  clearHighlights();
}

// --------------------
// Click logic
// --------------------
document.querySelectorAll('.op').forEach(b=>{
  b.onclick=()=>{
    if(state.selection.first===null) return;
    clearHighlights();
    b.classList.add('selected');
    state.selection.op=b.dataset.op;
    highlightFirst();
  };
});

function highlightFirst(){
  const btn=numbersRow.children[state.selection.first];
  if(btn) btn.classList.add('selected');
}

function numberClick(i){
  const sel=state.selection;
  if(sel.first===null){
    sel.first=i;
    highlightFirst();
    return;
  }
  if(sel.op===null) return;

  const a=state.numbers[sel.first];
  const b=state.numbers[i];
  if(sel.op==='/'&&(b===0||a%b!==0)) return;

  const res=eval(`${a}${sel.op}${b}`);
  setTimeout(()=>{
    state.numbers=state.numbers.filter((_,k)=>k!==sel.first&&k!==i);
    state.numbers.unshift(res);
    render();
    resetSelection();
    if(state.numbers.length===1){
      if(state.numbers[0]===state.target){
        state.score+=100;
        scoreEl.textContent=state.score;
        showFireworks();
        setTimeout(newProblem,3000);
      }else{
        setTimeout(()=>{
          state.numbers=state.original.slice();
          render();
        },3000);
      }
    }
  },500);
}

// --------------------
// Hints (deterministic)
// --------------------
document.getElementById('hintBtn').onclick=()=>{
  if(state.hints>=state.solution.length) return;
  state.hints++;
  hintsEl.textContent=state.hints;

  const step=state.solution[state.hints-1];
  const nums=state.numbers;
  const ai=nums.indexOf(step.a);
  const bi=nums.indexOf(step.b);

  let d=0;
  for(let r=0;r<2;r++){
    setTimeout(()=>highlightNum(ai),d+=500);
    setTimeout(()=>highlightOp(step.op),d+=500);
    setTimeout(()=>highlightNum(bi),d+=500);
    setTimeout(clearHighlights,d+=500);
  }
};

function highlightNum(i){
  clearHighlights();
  const b=numbersRow.children[i];
  if(b) b.classList.add('selected');
}

function highlightOp(op){
  clearHighlights();
  document.querySelector(`.op[data-op="${op}"]`)?.classList.add('selected');
}

// --------------------
// Reset / New
// --------------------
document.getElementById('resetBtn').onclick=()=>{
  state.numbers=state.original.slice();
  render();
  resetSelection();
};
document.getElementById('newBtn').onclick=newProblem;

// --------------------
// Fireworks
// --------------------
const canvas=document.getElementById('fireworksCanvas');
const ctx=canvas.getContext('2d');
function showFireworks(){
  canvas.style.display='block';
  canvas.width=canvas.clientWidth;
  canvas.height=canvas.clientHeight;
  let t=0;
  const id=setInterval(()=>{
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let i=0;i<60;i++){
      ctx.fillStyle='white';
      ctx.fillRect(
        canvas.width/2+Math.cos(i+t)*t*3,
        canvas.height/2+Math.sin(i+t)*t*3,
        3,3
      );
    }
    if(t++>30){clearInterval(id);canvas.style.display='none';}
  },30);
}

// --------------------
newProblem();
</script>
</body>
</html>
