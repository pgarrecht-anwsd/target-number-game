<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Target Number Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  body{
    font-family: system-ui, sans-serif;
    background:#0f172a;
    color:#e5e7eb;
    display:flex;
    justify-content:center;
  }

  .container{
    width:960px;
    max-width:96vw;
    margin-top:48px;
    padding:18px;
    background:rgba(255,255,255,0.03);
    border-radius:12px;
    box-shadow:0 6px 20px rgba(0,0,0,0.4);
    text-align:center;
  }

  h1{margin-top:0}

  .row{
    display:flex;
    justify-content:center;
    gap:14px;
    margin:16px 0;
  }

  button{
    font-size:1.8rem;
    padding:18px 0;
    width:120px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    background:#334155;
    color:white;
    transition:transform 0.1s, filter 0.1s;
  }

  .op{width:80px}

  button.selected{
    filter:brightness(160%);
    transform:scale(1.05);
  }

  button:disabled{
    opacity:0.3;
    cursor:not-allowed;
  }

  .status{margin-top:12px;font-size:1.2rem}
  .instructions{opacity:0.8;margin-top:10px}

  canvas{
    position:fixed;
    inset:0;
    pointer-events:none;
  }
</style>
</head>

<body>
<canvas id="fx"></canvas>

<div class="container" role="application" aria-label="Target Number Game">
  <h1>Target Number</h1>
  <div class="status" id="status"></div>

  <div class="row nums" id="nums"></div>

  <div class="row ops">
    <button class="op" data-op="+">+</button>
    <button class="op" data-op="-">âˆ’</button>
    <button class="op" data-op="*">Ã—</button>
    <button class="op" data-op="/">Ã·</button>
  </div>

  <div class="row">
    <button id="hintBtn">Hint</button>
    <button id="resetBtn">Reset</button>
  </div>

  <div class="instructions">
    Click a number, then an operation, then another number.<br>
    Intermediate results must be integers.
  </div>
</div>

<script>
// -----------------------------
// Utilities
// -----------------------------
function randInt(max){ return Math.floor(Math.random()*(max+1)); }
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

// -----------------------------
// Game State
// -----------------------------
const state = {
  numbers:[],
  target:0,
  selection:{first:null, op:null},
  hintCount:0
};

const numsDiv = document.getElementById("nums");
const status = document.getElementById("status");

// -----------------------------
// Setup
// -----------------------------
function newGame(){
  state.numbers = [];
  for(let i=0;i<4;i++) state.numbers.push(randInt(10));
  do {
  state.target = randInt(50);
} while (state.target === 0);
  state.selection.first = null;
  state.selection.op = null;
  state.hintCount = 0;
  render();
  status.textContent = `Target: ${state.target}`;
}

// -----------------------------
// Rendering
// -----------------------------
function render(){
  numsDiv.innerHTML = "";
  state.numbers.forEach((n,i)=>{
    const b = document.createElement("button");
    b.textContent = n;
    b.className = "num";
    if(state.selection.first === i) b.classList.add("selected");
    b.onclick = ()=>numberClick(i);
    numsDiv.appendChild(b);
  });

  document.querySelectorAll(".op").forEach(btn=>{
    btn.classList.toggle("selected", btn.dataset.op === state.selection.op);
    btn.onclick = ()=>pickOp(btn.dataset.op);
  });
}

// -----------------------------
// Selection Logic
// -----------------------------
function numberClick(i){
  const sel = state.selection;

  if(sel.first === null){
    sel.first = i;
    render();
    return;
  }

  if(sel.op === null) return;

  // ðŸ”’ BLOCK SAME NUMBER TWICE
  if(i === sel.first) return;

  compute(sel.first, i, sel.op);
}

function pickOp(op){
  if(state.selection.first === null) return;
  state.selection.op = (state.selection.op === op) ? null : op;
  render();
}

// -----------------------------
// Computation
// -----------------------------
async function compute(i,j,op){
  const a = state.numbers[i];
  const b = state.numbers[j];
  let r;

  if(op === "+") r = a+b;
  if(op === "-") r = a-b;
  if(op === "*") r = a*b;
  if(op === "/"){
    if(b === 0 || a % b !== 0){
      resetSelection();
      return;
    }
    r = a/b;
  }

  highlightTriple(i,op,j);

  await sleep(550);

  const hi = Math.max(i,j);
  const lo = Math.min(i,j);
  state.numbers.splice(hi,1);
  state.numbers.splice(lo,1);
  state.numbers.push(r);

  resetSelection();
  render();

  if(state.numbers.length === 1){
    if(state.numbers[0] === state.target){
      await successFX();
      newGame();
    }else{
      await sleep(3000);
      render();
    }
  }
}

function resetSelection(){
  state.selection.first = null;
  state.selection.op = null;
}

// -----------------------------
// Hint Logic (FIXED)
// -----------------------------
function findTwoDistinctIndices(arr,a,b){
  let first=-1, second=-1;
  for(let i=0;i<arr.length;i++){
    if(arr[i]===a && first===-1) first=i;
    else if(arr[i]===b && i!==first){ second=i; break; }
  }
  return (first!==-1 && second!==-1) ? [first,second] : null;
}

async function showHint(){
  const nums = state.numbers;

  for(let i=0;i<nums.length;i++){
    for(let j=0;j<nums.length;j++){
      if(i===j) continue;
      const a = nums[i], b = nums[j];
      const ops = [
        ["+", a+b],
        ["-", a-b],
        ["*", a*b],
        ["/", (b!==0 && a%b===0)?a/b:null]
      ];

      for(const [op,res] of ops){
        if(res===null) continue;
        const test = nums.filter((_,k)=>k!==i&&k!==j).concat(res);
        if(test.length===1 && test[0]===state.target){
          const idx = findTwoDistinctIndices(nums,a,b);
          if(!idx) return;
          for(let k=0;k<2;k++){
            await flash(idx[0],op,idx[1]);
          }
          return;
        }
      }
    }
  }
}

// -----------------------------
// Visual Effects
// -----------------------------
async function flash(i,op,j){
  state.selection.first = i;
  state.selection.op = null;
  render();
  await sleep(500);
  state.selection.op = op;
  render();
  await sleep(500);
  state.selection.first = j;
  render();
  await sleep(500);
  resetSelection();
  render();
}

async function highlightTriple(i,op,j){
  state.selection.first=i;
  state.selection.op=op;
  render();
}

async function successFX(){
  fireworks();
  beep();
  await sleep(3000);
}

// -----------------------------
// Fireworks + Sound
// -----------------------------
function fireworks(){
  const c=document.getElementById("fx");
  const ctx=c.getContext("2d");
  c.width=innerWidth; c.height=innerHeight;
  for(let i=0;i<120;i++){
    ctx.fillStyle=`hsl(${Math.random()*360},100%,60%)`;
    ctx.beginPath();
    ctx.arc(Math.random()*c.width,Math.random()*c.height,3,0,6.28);
    ctx.fill();
  }
  setTimeout(()=>ctx.clearRect(0,0,c.width,c.height),1200);
}

function beep(){
  try{
    const a=new AudioContext();
    const o=a.createOscillator();
    o.connect(a.destination);
    o.frequency.value=880;
    o.start();
    o.stop(a.currentTime+0.3);
  }catch{}
}

// -----------------------------
// Buttons
// -----------------------------
document.getElementById("resetBtn").onclick=newGame;
document.getElementById("hintBtn").onclick=showHint;

// -----------------------------
// Start
// -----------------------------
newGame();
</script>
</body>
</html>
